<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vue router</title>
  </head>
  <body>
    <div id="app">
      <App />
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>

    <script>
      let loggedIn = false; // Change value to test redirection

      let Course = {
        template: `
            <div class="course">
            Course
            </div>
          `,
        mounted() {
          if (!loggedIn) {
            this.$router.push({
              name: "login",
              query: {
                redirect: this.$route.path
              }
            });
          }
        }
      };

      let Home = {
        template: `
            <div class="home">
                Home
            </div>
            `,
        mounted() {
          // Route object information
          console.log(this.$route);
        }
      };

      let About = {
        template: `
            <div class="about">
                About
            </div>
            `
      };

      let Faq = {
        template: `
            <div class="faq">
                FAQ - <router-link :to="{ name: 'contact'}">Contact us</router-link>
            </div>
            `
      };

      let Contact = {
        template: `
            <div class="contact">
                Contact
            </div>
            `
      };

      let Navigation = {
        template: `
            <ul>
            <!--
            <li><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
            -->
            <li><router-link :to="{ path: '/' }">Home</router-link></li>
            <li><router-link :to="{ path: '/about' }">About</router-link></li>
            <li><router-link :to="{ path: '/contact' }">Contact</router-link></li>
            <li><router-link :to="{ path: '/faq' }">FAQ</router-link></li>
            <li><router-link :to="{ path: '/redirect' }">Redirect</router-link></li>
            <li><router-link :to="{ name: '404' }">404</router-link></li>
            </ul>
          `
      };

      let App = {
        template: `
            <div>
            <h1>Vue Router</h1>
            <navigation></navigation>
            <router-view></router-view>
            </div>
          `,
        components: { Navigation }
      };

      let User = {
        props: ["id"],
        template: `
            <div class="user">User {{ id }}</div>
          `,
        mounted() {
          console.log(this.$route.params);
        }
      };

      let Post = {
        //props: ["topicId", "postId"],
        props: {
          topicId: {
            type: String
          },
          postId: {
            type: String
          }
        },
        template: `
            <div class="post">Post</div>
          `,
        mounted() {
          console.log(this.$route.params);
          console.log(this.topicId, this.postId);
        }
      };

      let NotFound = {
        template: `
          <div>
          <p>404</p>
          <a href="#" @click.prevent="back">Go back</a>
          </div>
          `,
        methods: {
          back() {
            //console.log("back");
            this.$router.go(-1);
          }
        }
      };

      let Redirect = {
        template: `
            <div>This div will never be displayed</div>
          `,
        mounted() {
          /*
          // Always use push
          this.$router.push({
            name: "home"
          });
          */
          // Remove browser history
          this.$router.replace({
            name: "home"
          });
        }
      };

      let Login = {
        template: `
            <button type="submit" @click.prevent="login">Login</button>
          `,
        methods: {
          login() {
            loggedIn = true;
            let redirect = this.$route.query.redirect;
            //console.log(redirect);
            if (redirect) {
              this.$router.push(redirect);
              return;
            }

            this.$router.push({ name: "home" });
          }
        }
      };

      // Default props using data
      /*
      let News = {
        props: ["type"],
        data() {
          return {
            newsType: this.type
          };
        },
        template: `
        <div class="news">News {{ newsType }}</div>
          `,
        mounted() {
          if (!this.type) {
            this.newsType = "all";
          }
        }
      };
      */

      let News = {
        props: {
          type: {
            default: "all"
          }
        },
        template: `
        <div class="news">News {{ type }}</div>
          `
      };

      let Account = {
        template: `
        <div class="account">
        <h2>Account</h2>
        <router-view></router-view>
        </div>
          `
      };

      let AccountHome = {
        template: `
        <div class="account">Account home</div>
          `
      };

      let AccountProfile = {
        template: `
        <div class="account">Account profile</div>
          `
      };

      let AccountPassword = {
        template: `
        <div class="account">Account password</div>
          `
      };

      let Topic = {
        template: `
          <div class="topic">
            <h2>Topic</h2>
            <router-view></router-view>
          </div>
          `
      };

      let Articles = {
        props: ["topicId"],
        template: `
          <div class="articles">
            <p>Articles for topic {{ topicId }}</p>
          </div>
          `
      };

      let Article = {
        props: ["articleId"],
        template: `
          <div class="article">
            <p>Article {{ articleId }}</p>
            <router-view></router-view>
          </div>
          `
      };

      let ArticleReply = {
        props: ["articleId"],
        template: `
          <div class="article">
            <p>Reply to article {{ articleId }}</p>
          </div>
          `
      };

      let router = new VueRouter({
        //mode: "hash",
        mode: "history",
        routes: [
          {
            path: "/",
            component: Home,
            name: "home"
          },
          {
            path: "/about",
            component: About,
            name: "about"
          },
          {
            path: "/faq",
            component: Faq,
            name: "faq"
          },
          {
            path: "/contact",
            component: Contact,
            name: "contact"
          },
          {
            path: "/redirect",
            component: Redirect,
            name: "redirect"
          },
          {
            path: "/courses/:id",
            component: Course,
            name: "course"
          },
          {
            path: "/login",
            component: Login,
            name: "login"
          },
          {
            path: "/404",
            component: NotFound,
            name: "404"
          },
          {
            path: "/users/:id",
            component: User,
            props: true
          },
          {
            path: "/topics/:topicId/posts/:postId",
            component: Post,
            props: true
            /*
            props: (route) => {
                return {
                    topicId: parseInt(route.params.topicId),
                    postId: parseInt(route.params.postId)
                }
            }
            */
          },
          {
            path: "/news/:type",
            component: News,
            name: "news"
          },
          {
            path: "/news",
            component: News,
            name: "news:all"
          },
          {
            path: "/account",
            component: Account,
            children: [
              {
                path: "",
                component: AccountHome
              },
              {
                path: "profile",
                component: AccountProfile
              },
              {
                path: "password",
                component: AccountPassword
              }
            ]
          },
          {
            path: "/topics/:topicId",
            component: Topic,
            children: [
              {
                path: "articles",
                component: Articles,
                props: true
              },
              {
                path: "articles/:articleId",
                component: Article,
                props: true,
                children: [
                  {
                    path: "reply",
                    component: ArticleReply,
                    props: true
                  }
                ]
              }
              /*
              {
                path: "articles/:articleId/reply",
                component: ArticleReply,
                props: true
              }
              */
            ]
          }
          /*
          {
            path: "/account/profile",
            component: AccountProfile,
          },
          {
            path: "/account/password",
            component: AccountPassword,
          }
          */
        ]
      });

      let app = new Vue({
        el: "#app",
        router: router,
        components: { App }
      });
    </script>
  </body>
</html>
